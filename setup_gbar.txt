# change directory
cd Desktop

# clone our directory and change to it
git clone https://github.com/albertkjoller/explainableVQA

# change directory
cd explainableVQA

# load python 3.8.11 from the GBAR server
module load python3/3.8.11

# create virtual environment
python3.8 -m venv vqa

# activate it
source vqa/bin/activate

# ----------------------------------------------------#

# change directory
cd mmf

# install dependencies
python3 -m pip install --editable .

# install torch <https://pytorch.org/get-started/previous-versions/>
python3 -m pip install torch==1.8.0+cu111 torchvision torchaudio torchtext -f https://download.pytorch.org/whl/torch_stable.html

# install torch-geometric <https://pytorch-geometric.readthedocs.io/en/latest/notes/installation.html>
 python3 -m pip install torch-scatter==2.0.8 torch-sparse==0.6.12 torch-cluster==1.5.9 torch-spline-conv torch-geometric -f https://data.pyg.org/whl/torch-1.8.0+cu111.html
 #    - look into the website and wheels to find matching versions with torch

# install detectron2 <https://github.com/facebookresearch/detectron2/blob/main/INSTALL.md#common-installation-issues>
python3 -m pip install detectron2 -f https://dl.fbaipublicfiles.com/detectron2/wheels/cu111/torch1.8/index.html

#maybe upgrade numpy?

# ----------------------------------------------------#

# for running a script create a shell-file for submission and run it, e.g.:
bsub < predict_demo.sh
bsub < train.sh

# if using pretrained models, follow instruction in ReadMe-file.

# ----------------------------------------------------#
Commands for training:

# Working directory: explainableVQA/mmf
# Modify env.save_dir for current experiment (avoid overwriting)

# run command
mmf_run config='configs/experiments/model_name/run_type.yaml' \
    datasets=dataset_name \
    model=model_name \
    run_type=train_val \
    env.data_dir=/work3/s******/torch/mmf/data \
    env.save_dir=/work3/s******/save/models/your_choice \
    trainer.params.gpus=1 \

# for fast run command add:
# training.max_updates=1 \

# example:
mmf_run config='configs/experiments/pilot/test.yaml' \
    datasets=okvqa \
    model=pilot \
    run_type=train_val \
    env.data_dir=/work3/s194262/torch/mmf/data \
    env.save_dir=/work3/s194262/save/models/pilot_grids \
    trainer.params.gpus=1 \

